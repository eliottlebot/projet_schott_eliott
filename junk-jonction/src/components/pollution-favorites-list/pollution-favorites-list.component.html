<div class="bg-[url(/jj-bg.webp)] h-full flex-1 bg-cover bg-center flex flex-col">
  <div class="flex justify-end gap-4 p-5 bg-white/20 shadow-b-lg items-center">
    <p class="rounded-full bg-slate-50 hover:bg-slate-100 border border-slate-200 px-4 py-2">
      @if(favoritesCount$ | async; as favoritesCount){
      {{ favoritesCount }} pollutions marquées en favori. } @else { Aucune pollution marquée en
      favori. }
    </p>
    <button
      class="rounded-full bg-slate-50 hover:bg-slate-100 border border-slate-200 px-4 py-2"
      (click)="sortByDate()"
    >
      Trier par date décroissante
    </button>
    <button
      class="rounded-full bg-slate-50 hover:bg-slate-100 border border-slate-200 px-4 py-2"
      (click)="resetSorting()"
    >
      Réinitialiser le tri
    </button>
  </div>

  @if(selectedPollution$(); as selectedPollution){
  <app-pollution-details-modal
    [pollution]="selectedPollution"
    [closeModal]="closeModal"
  ></app-pollution-details-modal>
  }

  <!-- Scrollable list area -->
  @if(favoritePollutions$ | async; as favoritePollutions){ @if(favoritePollutions.length > 0){
  <div class="flex-1 overflow-auto">
    <div class="m-2 grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3">
      @for(pollution of favoritePollutions; track $index){
      <div
        class="relative rounded-xl p-5 shadow-md border border-green-300 bg-gradient-to-br from-green-50 to-green-100 hover:from-green-100 hover:to-green-200 transition"
      >
        <button
          class="absolute top-3 right-3 z-10 focus:outline-none"
          (click)="removeFavorite(pollution.id)"
        >
          <img
            src="favorite_selected.svg"
            width="30px"
            height="30px"
            class="cursor-pointer hover:scale-110 transition-all"
          />
        </button>

        <h3 class="text-lg font-semibold text-green-800 mb-2">{{ pollution.type_pollution }}</h3>

        <p class="mb-1 text-green-700">
          <strong>Localisation :</strong> {{ pollution.latitude }} : {{ pollution.longitude }}
        </p>

        <p class="mb-1 text-green-700">
          <strong>Description :</strong> {{ pollution.description }}
        </p>

        <p class="mb-3 text-green-700">
          <strong>Date :</strong> {{ pollution.date_observation | date : 'medium' }}
        </p>

        <div class="flex justify-between">
          <button
            (click)="deletePollution(pollution.id)"
            class="flex items-center px-3 py-1 bg-red-100 rounded hover:bg-red-200 transition"
          >
            <lucide-icon [img]="Trash" class="w-6 h-6 text-red-600"></lucide-icon>
          </button>

          <button
            (click)="showDetails(pollution.id)"
            class="flex items-center gap-1 px-3 py-1 bg-green-200 rounded hover:bg-green-300 transition"
          >
            <lucide-icon [img]="Info" class="w-5 h-5 text-green-700"></lucide-icon>
            <span class="text-green-800 font-medium">Détails</span>
          </button>
        </div>
      </div>
      }
    </div>
  </div>
  } @else {
  <div class="flex-1 flex items-center justify-center">
    <div class="bg-white/75 p-8 rounded-lg text-center">
      <lucide-icon [img]="Heart" class="w-16 h-16 mx-auto mb-4 text-gray-400"></lucide-icon>
      <h2 class="text-2xl font-semibold text-gray-700 mb-2">Aucun favori</h2>
      <p class="text-gray-600">Vous n'avez pas encore ajouté de pollution à vos favoris.</p>
    </div>
  </div>
  } } @else {
  <p class="p-4">Chargement de la liste...</p>
  }
</div>
